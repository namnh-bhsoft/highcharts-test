<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>HighCharts test</title>
    <script src="https://code.jquery.com/jquery-1.9.1.js"></script>
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/highcharts-more.js"></script>
    <script src="https://code.highcharts.com/modules/data.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jscolor/2.0.4/jscolor.js"></script>
    <!--<script src="./highchart-line-symbol-style.js"></script>-->

    <!--Highcharts settings goes here-->
    <script>

        // Data from server
        // <w7c-config-replacement/>
        const w7cConfig = {
            "columncount": 1,
            "rowcount": 1,
            "charts": [{
                "column": 0,
                "row": 0,
                "type": "regular",
                "legend": {
                    "visible": false,
                    "floating": true,
                    "layout": "vertical",
                    "hAlign": "center",
                    "vAlign": "middle",
                    "padding": 20,
                    "margin": 20,
                    "bordersize": 1,
                    "xpos": 0,
                    "ypos": 0
                },
                "xaxis": [{
                    "label": "n",
                    "position": "bottom",
                    "scale": "auto",
                    "min": 0,
                    "max": 0,
                    "reversed": false,
                    "yaxis": [{
                        "position": "left",
                        "scale": "auto",
                        "label": "v",
                        "reversed": false,
                        "min": 0,
                        "max": 0,
                        "plots": [{
                            "label": "Part 1",
                            "hidden": false,
                            "visible": true,
                            "flyover": true,
                            "lineColor": {
                                "r": 40,
                                "g": 91,
                                "b": 7873,
                                "a": 1
                            },
                            "lineStyle": "solid",
                            "lineSize": 1,
                            "symbolColor": {
                                "r": 224,
                                "g": 217,
                                "b": 7796,
                                "a": 1
                            },
                            "symbolFillColor": {
                                "r": 152,
                                "g": 91,
                                "b": 7873,
                                "a": 1
                            },
                            "symbolStyle": "triangle",
                            "symbolSize": 3
                        }, {
                            "label": "Part 2",
                            "hidden": false,
                            "visible": true,
                            "flyover": true,
                            "lineColor": {
                                "r": 0,
                                "g": 73,
                                "b": 3323,
                                "a": 1
                            },
                            "lineStyle": "solid",
                            "lineSize": 1,
                            "symbolColor": {
                                "r": 160,
                                "g": 89,
                                "b": 7873,
                                "a": 1
                            },
                            "symbolFillColor": {
                                "r": 40,
                                "g": 105,
                                "b": 7873,
                                "a": 1
                            },
                            "symbolStyle": "triangle",
                            "symbolSize": 3
                        }, {
                            "label": "Part 3",
                            "hidden": false,
                            "visible": true,
                            "flyover": true,
                            "lineColor": {
                                "r": 40,
                                "g": 84,
                                "b": 7873,
                                "a": 1
                            },
                            "lineStyle": "solid",
                            "lineSize": 1,
                            "symbolColor": {
                                "r": 32,
                                "g": 86,
                                "b": 7873,
                                "a": 1
                            },
                            "symbolFillColor": {
                                "r": 112,
                                "g": 94,
                                "b": 7873,
                                "a": 1
                            },
                            "symbolStyle": "triangle",
                            "symbolSize": 3
                        }, {
                            "label": "Part 4",
                            "hidden": true,
                            "visible": true,
                            "flyover": false,
                            "lineColor": {
                                "r": 0,
                                "g": 0,
                                "b": 0,
                                "a": 1
                            },
                            "lineStyle": null,
                            "lineSize": 0,
                            "symbolColor": {
                                "r": 0,
                                "g": 0,
                                "b": 0,
                                "a": 1
                            },
                            "symbolFillColor": {
                                "r": 0,
                                "g": 0,
                                "b": 0,
                                "a": 1
                            },
                            "symbolStyle": null,
                            "symbolSize": 0
                        }, {
                            "label": "Part 5",
                            "hidden": true,
                            "visible": true,
                            "flyover": false,
                            "lineColor": {
                                "r": 0,
                                "g": 0,
                                "b": 0,
                                "a": 1
                            },
                            "lineStyle": null,
                            "lineSize": 0,
                            "symbolColor": {
                                "r": 0,
                                "g": 0,
                                "b": 0,
                                "a": 1
                            },
                            "symbolFillColor": {
                                "r": 0,
                                "g": 0,
                                "b": 0,
                                "a": 1
                            },
                            "symbolStyle": null,
                            "symbolSize": 0
                        }]
                    }]
                }]
            }]
        };
        // <w7c-data-replacement/>
        const w7cData = {
            "charts": [{
                "column": 0,
                "row": 0,
                "title": "Meter Calibration",
                "subtitle": "Meter 3 / 1.2.2012",
                "xaxis": [{
                    "label": "n",
                    "unit": "1/s",
                    "yaxis": [{
                        "label": "v",
                        "unit": "m/s",
                        "plots": [{
                            "label": "Part 1",
                            "data": [
                                [0, 0.0121],
                                [1.8261, 0.46825978]
                            ]
                        }, {
                            "label": "Part 2",
                            "data": [
                                [1.8261, 0.46825972],
                                [6.6346, 1.64730392]
                            ]
                        }, {
                            "label": "Part 3",
                            "data": [
                                [6.6346, 1.647304],
                                [13.1667, 3.215008]
                            ]
                        }, {
                            "label": "Part 4",
                            "data": [
                                [13.1667, 3.21500768],
                                [26.3334, 6.24861536]
                            ]
                        }, {
                            "label": "Part 5",
                            "data": []
                        }]
                    }]
                }]
            }]
        };

        // Settings
        let chart;
        let highchart_test = function () {
            let self = this;

            self.Init = function () {
                self.DisplayHighChart();
            };

            self.DisplayHighChart = function () {
                const values = [...w7cData.charts[0].xaxis[0].yaxis[0].plots];
                for (let i = 0; i < values.length; i++) {
                    values[i].color = "rgba(" + Object.values(w7cConfig.charts[0].xaxis[0].yaxis[0].plots[i].lineColor) + ")";
                    values[i].name = values[i].label;
                    values[i].yAxis = i;
                    values[i].visible = w7cConfig.charts[0].xaxis[0].yaxis[0].plots[i].hidden;
                }

                const yAxisValues = [...w7cConfig.charts[0].xaxis[0].yaxis[0].plots];
                for (let i = 0; i < yAxisValues.length; i++) {
                    yAxisValues[i].title = {
                        text: yAxisValues[i].label
                    };
                    yAxisValues[i].lineColor = "rgba(" + Object.values(yAxisValues[i].lineColor) + ")";
                    yAxisValues[i].lineWidth = yAxisValues[i].lineSize;
                }

                let chartElem = 'container';
                let chartConf = {
                    chart: {
                        zoomType: 'xy',
                        marginBottom: 100
                    },
                    title: {
                        text: w7cData.charts[0].title
                    },
                    subtitle: {
                        text: w7cData.charts[0].subtitle
                    },
                    xAxis: {
                        title: {
                            useHTML: true,
                            enabled: true,
                            text: w7cData.charts[0].xaxis[0].label + ' ' + w7cData.charts[0].xaxis[0].unit,
                            align: 'high'
                        },
                        startOnTick: true,
                        endOnTick: true,
                        showLastLabel: true
                    },
                    yAxis: yAxisValues,
                    tooltip: {
                        useHTML: true,
                        formatter: function () {
                            return `${this.series.name} </br> x:${this.x} y:${this.y}`
                        }
                    },
                    legend: {
                        useHTML: true,
                        layout: 'horizontal',
                        align: 'center',
                        verticalAlign: 'bottom',
                        floating: false,
                        backgroundColor: (Highcharts.theme && Highcharts.theme.legendBackgroundColor) || '#FFFFFF',
                        borderWidth: 1
                    },
                    series: values
                };

                chart = Highcharts.chart(chartElem, chartConf);
            }
        };

        // Init highcharts
        $(document).ready(function () {
            let highchart = new highchart_test();
            highchart.Init();
        });

    </script>
    <style>
        .highcharts-credits {
            display: none;
        }

        #container {
            height: 100vh;
        }
    </style>
</head>
<body>

<div id="container"></div>
<img src="issue-sample-1.png" alt="" width="100%">

</body>
</html>

